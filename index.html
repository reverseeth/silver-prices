<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Silver Premium | SGE vs COMEX</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-sans/style.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/geist@1.3.1/dist/fonts/geist-mono/style.min.css" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --black: #000000;
      --g1: #0a0a0a;
      --g2: #111111;
      --g3: #171717;
      --g4: #1c1c1c;
      --g5: #222222;
      --g6: #2e2e2e;
      --g7: #3a3a3a;
      --g8: #505050;
      --g9: #6e6e6e;
      --g10: #8f8f8f;
      --g11: #b0b0b0;
      --g12: #e0e0e0;
      --white: #fafafa;
      --green: #00cc88;
      --green-m: rgba(0,204,136,0.1);
      --red: #ef4444;
      --red-m: rgba(239,68,68,0.1);
      --amber: #ca8a04;
    }

    html { font-size: 16px; -webkit-font-smoothing: antialiased; }

    body {
      font-family: 'Geist', -apple-system, system-ui, sans-serif;
      background: var(--black);
      color: var(--g12);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .page { max-width: 840px; margin: 0 auto; padding: 0 24px 64px; }

    /* HEADER */
    .header {
      padding: 48px 0 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      opacity: 0; animation: up .6s ease forwards;
    }

    .wordmark { display: flex; align-items: center; gap: 10px; }

    .wordmark svg { width: 20px; height: 20px; color: var(--g10); }

    .wm-text { font-size: .8125rem; font-weight: 500; color: var(--white); letter-spacing: -.01em; }

    .live-ind { display: flex; align-items: center; gap: 8px; font-size: .6875rem; color: var(--g9); }

    .live-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); position: relative; }

    .live-dot::after {
      content: ''; position: absolute; inset: -3px; border-radius: 50%;
      border: 1px solid var(--green); opacity: 0;
      animation: ping 2.5s cubic-bezier(0,0,.2,1) infinite;
    }

    @keyframes ping { 0%{transform:scale(1);opacity:.5} 100%{transform:scale(2.2);opacity:0} }

    .sep { height: 1px; background: var(--g3); margin: 24px 0; opacity:0; animation: up .6s ease .05s forwards; }

    /* PREMIUM */
    .prem {
      padding: 40px 0 44px; text-align: center;
      opacity: 0; animation: up .6s ease .1s forwards;
    }

    .prem-ico {
      display: inline-flex; align-items: center; justify-content: center;
      width: 40px; height: 40px; border-radius: 12px;
      background: var(--g2); border: 1px solid var(--g4);
      margin-bottom: 20px; color: var(--g10);
      transition: border-color .4s;
    }

    .prem-ico svg { width: 18px; height: 18px; }
    .prem-ico.ok { border-color: var(--g5); }

    .prem-ey {
      font-size: .6875rem; font-weight: 400; color: var(--g8);
      letter-spacing: .06em; text-transform: uppercase; margin-bottom: 16px;
    }

    .prem-n {
      font-family: 'Geist Mono', monospace; font-size: 3.5rem; font-weight: 500;
      letter-spacing: -.04em; line-height: 1; transition: color .4s;
    }

    .prem-n.pos { color: var(--green); }
    .prem-n.neg { color: var(--red); }
    .prem-n.nil { color: var(--g6); }

    .prem-d {
      margin-top: 12px; font-family: 'Geist Mono', monospace;
      font-size: .8125rem; color: var(--g7);
    }

    .prem-d em { font-style: normal; color: var(--g10); }

    .prem-c { margin-top: 20px; font-size: .75rem; color: var(--g7); }

    /* GRID */
    .grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 1px;
      background: var(--g3); border: 1px solid var(--g3); border-radius: 16px;
      overflow: hidden; opacity: 0; animation: up .6s ease .18s forwards;
    }

    .card { background: var(--g1); transition: background .3s; }
    .card:hover { background: var(--g2); }

    .card-in { padding: 28px 28px 30px; }

    .card-hd { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }

    .card-lb { display: flex; align-items: center; gap: 10px; }

    .card-ic {
      width: 32px; height: 32px; border-radius: 9px;
      background: var(--g3); border: 1px solid var(--g4);
      display: grid; place-items: center; color: var(--g10);
      flex-shrink: 0; transition: border-color .3s;
    }

    .card:hover .card-ic { border-color: var(--g5); }
    .card-ic svg { width: 15px; height: 15px; }

    .card-nm { font-size: .8125rem; font-weight: 500; color: var(--g12); letter-spacing: -.01em; }
    .card-sb { font-size: .6875rem; color: var(--g8); margin-top: 1px; }

    .bg {
      font-size: .5625rem; font-weight: 500; text-transform: uppercase;
      letter-spacing: .05em; padding: 4px 8px 3px; border-radius: 6px;
      display: inline-flex; align-items: center; gap: 5px;
    }

    .bg-d { width: 4px; height: 4px; border-radius: 50%; }

    .bg-live { color: var(--green); background: var(--green-m); }
    .bg-live .bg-d { background: var(--green); animation: bk 2s ease-in-out infinite; }

    .bg-del { color: var(--amber); background: rgba(202,138,4,.08); }
    .bg-del .bg-d { background: var(--amber); opacity: .6; }

    @keyframes bk { 0%,100%{opacity:1} 50%{opacity:.1} }

    /* Price */
    .pr { display: flex; align-items: baseline; gap: 7px; }

    .pv {
      font-family: 'Geist Mono', monospace; font-size: 1.875rem; font-weight: 500;
      color: var(--white); letter-spacing: -.035em; line-height: 1;
    }

    .pu { font-size: .6875rem; color: var(--g7); }
    .pd { margin-top: 6px; font-size: .6875rem; color: var(--g7); }

    /* Pill */
    .pl {
      display: inline-flex; align-items: center; gap: 4px; margin-top: 16px;
      font-family: 'Geist Mono', monospace; font-size: .6875rem; font-weight: 500;
      padding: 5px 10px; border-radius: 8px; line-height: 1;
    }

    .pl.up { color: var(--green); background: var(--green-m); }
    .pl.dn { color: var(--red); background: var(--red-m); }
    .pl.fl { color: var(--g8); background: var(--g3); }

    .pl-a { font-size: .5rem; }

    /* Sep & Meta */
    .cs { height: 1px; background: var(--g3); margin: 20px 0 16px; }

    .mt { display: flex; flex-direction: column; gap: 9px; }

    .mi { display: flex; justify-content: space-between; align-items: center; }

    .mk { font-size: .6875rem; color: var(--g7); }

    .mv { font-family: 'Geist Mono', monospace; font-size: .6875rem; color: var(--g10); }

    /* Ranges */
    .rg { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-top: 18px; }

    .rb {
      background: var(--g2); border: 1px solid var(--g3); border-radius: 8px;
      padding: 10px 8px; text-align: center; transition: border-color .2s;
    }

    .rb:hover { border-color: var(--g5); }

    .rb-l { font-size: .5625rem; text-transform: uppercase; letter-spacing: .06em; color: var(--g7); margin-bottom: 4px; }

    .rb-v { font-family: 'Geist Mono', monospace; font-size: .75rem; color: var(--g11); }

    /* States */
    .sl, .se { padding: 52px 0; text-align: center; }

    .ld {
      width: 20px; height: 20px; border: 1.5px solid var(--g4);
      border-top-color: var(--g8); border-radius: 50%;
      margin: 0 auto 12px; animation: sp .65s linear infinite;
    }

    @keyframes sp { to { transform: rotate(360deg); } }

    .st { font-size: .75rem; color: var(--g7); }

    .er { font-size: .75rem; color: var(--red); opacity: .7; margin-bottom: 14px; }

    .bt {
      font-family: 'Geist', sans-serif; font-size: .6875rem; font-weight: 500;
      color: var(--g11); background: var(--g3); border: 1px solid var(--g4);
      border-radius: 8px; padding: 7px 20px; cursor: pointer; transition: all .15s;
    }

    .bt:hover { background: var(--g4); border-color: var(--g5); color: var(--white); }

    /* Footer */
    .fo {
      margin-top: 32px; text-align: center;
      opacity: 0; animation: up .6s ease .26s forwards;
    }

    .fo p { font-size: .625rem; color: var(--g6); line-height: 1.7; }

    /* Anim */
    @keyframes up { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }

    .fl { animation: nf .5s ease; }
    @keyframes nf { 0%{opacity:.4} 100%{opacity:1} }

    /* Responsive */
    @media(max-width:640px) {
      .page { padding: 0 16px 48px; }
      .header { padding-top: 32px; }
      .prem { padding: 28px 0 32px; }
      .prem-n { font-size: 2.5rem; }
      .prem-d { font-size: .75rem; }
      .grid { grid-template-columns: 1fr; border-radius: 14px; }
      .card-in { padding: 22px 20px 24px; }
      .pv { font-size: 1.5rem; }
      .card-ic { width: 28px; height: 28px; border-radius: 8px; }
      .card-ic svg { width: 13px; height: 13px; }
      .prem-ico { width: 36px; height: 36px; border-radius: 10px; }
      .prem-ico svg { width: 16px; height: 16px; }
      .rg { gap: 4px; }
      .rb { padding: 8px 6px; border-radius: 6px; }
      .wm-text { font-size: .75rem; }
    }

    @media(max-width:380px) {
      .prem-n { font-size: 2rem; }
      .pv { font-size: 1.25rem; }
      .card-in { padding: 18px 16px 20px; }
    }
  </style>
</head>
<body>

<div class="page">

  <header class="header">
    <div class="wordmark">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v12M8 9.5c0-1.38 1.79-2.5 4-2.5s4 1.12 4 2.5-1.79 2.5-4 2.5-4 1.12-4 2.5 1.79 2.5 4 2.5"/></svg>
      <span class="wm-text">Silver Premium</span>
    </div>
    <div class="live-ind" id="status">
      <div class="live-dot"></div>
      <span id="sl">Connecting</span>
    </div>
  </header>

  <div class="sep"></div>

  <section class="prem">
    <div class="prem-ico" id="pi">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><path d="M5 7l7-4 7 4"/><path d="M5 7l-1 6c0 1.66 1.34 2 2 2h0c.66 0 2-.34 2-2L7 7"/><path d="M17 7l-1 6c0 1.66 1.34 2 2 2h0c.66 0 2-.34 2-2l-1-6"/></svg>
    </div>
    <div class="prem-ey">Shanghai Premium</div>
    <div class="prem-n nil" id="pp">--%</div>
    <div class="prem-d" id="pu">Loading</div>
    <div class="prem-c" id="pc">SGE Ag(T+D) minus COMEX XAG/USD</div>
  </section>

  <div class="sep"></div>

  <div class="grid">
    <div class="card">
      <div class="card-in">
        <div class="card-hd">
          <div class="card-lb">
            <div class="card-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21h18"/><path d="M5 21V7l7-4 7 4v14"/><path d="M9 21v-4h6v4"/><path d="M9 13h6"/><path d="M9 9h6"/></svg>
            </div>
            <div><div class="card-nm">Shanghai SGE</div><div class="card-sb">Ag(T+D)</div></div>
          </div>
          <div class="bg bg-del"><span class="bg-d"></span>Delayed</div>
        </div>
        <div id="sb">
          <div class="sl"><div class="ld"></div><div class="st">Fetching SGE</div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-in">
        <div class="card-hd">
          <div class="card-lb">
            <div class="card-ic">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 20h18"/><path d="M6 16l4-6 4 4 4-8"/></svg>
            </div>
            <div><div class="card-nm">COMEX</div><div class="card-sb">XAG / USD</div></div>
          </div>
          <div class="bg bg-live"><span class="bg-d"></span>Live</div>
        </div>
        <div id="cb">
          <div class="sl"><div class="ld"></div><div class="st">Fetching COMEX</div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="fo"><p>Data refreshes every 30 seconds. SGE quotes are delayed. FX rate: USD/CNY.</p></div>

</div>

<script>
const API='/api/prices',POLL=30000;
const f=(n,d=2)=>n.toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d});
const dr=v=>v>0?'up':v<0?'dn':'fl';
const ar=v=>v>0?'\u25B2':v<0?'\u25BC':'\u2014';
function fl(e){if(!e)return;e.classList.remove('fl');void e.offsetWidth;e.classList.add('fl')}

function rC(c){
  const d=dr(c.changePercent);
  document.getElementById('cb').innerHTML=`
    <div class="pr"><span class="pv" id="cv">${f(c.price,4)}</span><span class="pu">USD/oz</span></div>
    <div class="pd">per troy ounce</div>
    <div class="pl ${d}"><span class="pl-a">${ar(c.changePercent)}</span>${f(Math.abs(c.change),4)}&nbsp;&nbsp;${f(Math.abs(c.changePercent),2)}%</div>
    <div class="cs"></div>
    <div class="mt">
      <div class="mi"><span class="mk">Prev close</span><span class="mv">${f(c.prevClose,4)}</span></div>
      <div class="mi"><span class="mk">Updated</span><span class="mv">${c.timestamp}</span></div>
    </div>`;
  fl(document.getElementById('cv'));
}

function rS(s,fx){
  document.getElementById('sb').innerHTML=`
    <div class="pr"><span class="pv" id="sv">${f(s.usd_per_oz,4)}</span><span class="pu">USD/oz</span></div>
    <div class="pd">converted from ${f(s.rmb_per_kg,0)} RMB/kg</div>
    <div class="rg">
      <div class="rb"><div class="rb-l">Open</div><div class="rb-v">${s.rmb_open?f(s.rmb_open,0):'\u2014'}</div></div>
      <div class="rb"><div class="rb-l">High</div><div class="rb-v">${s.rmb_high?f(s.rmb_high,0):'\u2014'}</div></div>
      <div class="rb"><div class="rb-l">Low</div><div class="rb-v">${s.rmb_low?f(s.rmb_low,0):'\u2014'}</div></div>
    </div>
    <div class="cs"></div>
    <div class="mt">
      <div class="mi"><span class="mk">RMB/kg</span><span class="mv">${f(s.rmb_per_kg,0)}</span></div>
      <div class="mi"><span class="mk">USD/CNY</span><span class="mv">${f(fx.usd_cny,4)}</span></div>
    </div>`;
  fl(document.getElementById('sv'));
}

function rP(p){
  const e=document.getElementById('pp'),u=document.getElementById('pu'),c=document.getElementById('pc'),i=document.getElementById('pi');
  const s=p.percent>=0?'+':'';
  e.className='prem-n '+(p.percent>0?'pos':p.percent<0?'neg':'nil');
  e.textContent=s+f(p.percent,2)+'%';
  const us=p.usd>=0?'+':'';
  u.innerHTML='<em>'+us+f(p.usd,4)+'</em> USD per ounce';
  i.classList.add('ok');
  c.textContent=p.percent>0?'Shanghai silver trades at a premium to international spot':p.percent<0?'Shanghai silver trades at a discount to international spot':'Prices are aligned';
  fl(e);
}

function sE(id,m){document.getElementById(id).innerHTML=`<div class="se"><div class="er">${m}</div><button class="bt" onclick="ld()">Retry</button></div>`}
function rR(){document.getElementById('pp').textContent='--%';document.getElementById('pp').className='prem-n nil';document.getElementById('pu').textContent='Waiting for data'}

let L=null;
async function ld(){
  document.getElementById('sl').textContent='Updating';
  try{
    const r=await fetch(API),t=await r.text();
    let d;try{d=JSON.parse(t)}catch{throw new Error('Invalid response')}
    L=d;
    d.comex?rC(d.comex):sE('cb',d.errors?.find(e=>e.source==='comex')?.message||'Unavailable');
    d.sge&&d.fx?rS(d.sge,d.fx):sE('sb',d.errors?.find(e=>e.source==='sge'||e.source==='fx')?.message||'Unavailable');
    d.premium?rP(d.premium):rR();
    document.getElementById('sl').textContent='Live';
  }catch(e){
    document.getElementById('sl').textContent='Offline';
    if(!L){sE('sb',e.message);sE('cb',e.message);rR()}
  }
}
ld();setInterval(ld,POLL);
</script>
</body>
</html>
